<?xml version="1.0" encoding="UTF-8" ?>
<entity-mappings xmlns="http://java.sun.com/xml/ns/persistence/orm"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm http://java.sun.com/xml/ns/persistence/orm_1_0.xsd"
	version="1.0">
	<description>Output routing related objects</description>

	<named-query name="FIND_CONFIG_ON_VALUE_DATE">
		<query>
	   <![CDATA[	   
	        SELECT config 
            FROM RoutingConfigOnValueDate config 
            WHERE config.currency = ?1 AND config.clearingPeriod <= ?2 
            order by config.charge
       ]]>
	   </query>
	</named-query>

	<named-query name="FIND_OI_BATCHING_CONFIG">
		<query>
	        SELECT config 
            FROM OutputInstructionBatchingConfig config 
            WHERE config.clearingMechanism = ?1 
	   </query>
	</named-query>

	<named-query name="FIND_REMITTANCE_ACCOUNT">
		<query>
            SELECT config 
            FROM RemittanceAccountConfig config 
            WHERE config.clearingMechanism = ?1 
       </query>
	</named-query>

	<named-query name="GET_D_RULES_BY_SCHEMA">
		<query>
            select dRule 
            from DynamicRule dRule 
            where dRule.schema = ?1
            order by dRule.priority
       </query>
	</named-query>

	<named-query name="FIND_INS_BY_CURR">
		<query>	   
	       select ins
	       from Instruction ins
	       where ins.currency = ?1 and ins.outputInstructionId is null
	   </query>
	</named-query>
	
	<named-query name="FIND_OUT_INS_BY_CLM">
		<query>	   
	       select outIns
	       from OutputInstruction outIns
	       where outIns.clearingMechanism = ?1 and outIns.outputSubmissionId is null
	   </query>
	</named-query>
	
	<named-query name="GET_SUBMISSION_INSTRUCTION_COUNT">
		<query>	   
	       select count(ins)
	       from Instruction ins
	       where ins.submissionId = ?1
	   </query>
	</named-query>
	
	<named-query name="GET_SUBMISSION_COUNT_BY_ARRIVAL_DATE">
		<query>	   
	       select count(sub)
	       from Submission sub
	       where sub.submissionDate = ?1
	   </query>
	</named-query>
	
	<named-query name="GET_VALUES_BY_ARRIVAL_DATE">
		<query>	   
	       select concat(concat(ins.currency, '/'), sum(ins.amount))
	       from Instruction ins, Submission sub
	       where ins.submissionId = sub.id
	       and sub.submissionDate = ?1
		   group by ins.currency
	   </query>
	</named-query>
	
	<named-query name="GET_OUTPUT_VALUES">
		<query>	   
	       select concat(concat(ins.currency, '/'), sum(ins.amount))
	       from Instruction ins
		   where ins.outputInstructionId != null
		   group by ins.currency
	   </query>
	</named-query>
	
	<named-query name="GET_OUTPUT_SUBMISSION_COUNT">
		<query>	   
			select count(*)
			from OutputSubmission os			
	   </query>
	</named-query>
	
	<named-query name="GET_MOST_RECENT_ROUTE">
		<query>	   
			select os.clearingMechanism
			from OutputSubmission os
			order by os.id desc						
	   </query>
	</named-query>
	
	<named-query name="GET_MOST_RECENT_OUTPUT_SUBMISSION">
		<query>	   
			select os
			from OutputSubmission os
			order by os.id desc						
	   </query>
	</named-query>		
	
	<named-query name="UPDATE_INS">
		<query>
		        UPDATE Instruction ins SET ins.outputInstructionId =?1 WHERE ins.id = ?2
		</query>
	</named-query>
	
	<named-query name="GET_ALL_CONFIG_ON_VALUE_DATE">
		<query>
	        SELECT config 
            FROM RoutingConfigOnValueDate config 
            order by config.id
	   </query>
	</named-query>
	
	<named-query name="UPDATE_VALUE_DATE_CONFIG_BY_ID">
		<query>
	        UPDATE RoutingConfigOnValueDate config SET config.thresholdAmount =?1, config.charge =?2 WHERE config.id = ?3
	   </query>
	</named-query>
	
	<named-query name="GET_ALL_DYNAMIC_RULES">
		<query>
	        SELECT dynamicRule 
            FROM DynamicRule dynamicRule 
            order by dynamicRule.id
	   </query>
	</named-query>
	
	<named-query name="DELETE_DYNAMIC_RULE_BY_ID">
		<query>
	        DELETE FROM DynamicRule dynamicRule where dynamicRule.id =?1
	   </query>
	</named-query>

	<mapped-superclass class="com.travelex.tgbp.store.domain.PersistentEntity"
		access="FIELD">
		<attributes>
			<id name="id">
				<column name="ID" nullable="false" />
                <generated-value strategy="SEQUENCE" generator="SEQ_GEN" />
                <sequence-generator name="SEQ_GEN" sequence-name="SEQ_ENTITY" />
			</id>
		</attributes>
	</mapped-superclass>

	<entity class="com.travelex.tgbp.store.domain.Submission"
		access="FIELD">
		<table name="SUBMISSION" />
		<attributes>
			
			<basic name="messageId">
				<column name="MESSAGE_ID" nullable="true" />
			</basic>
			
			<basic name="fileName">
                <column name="FILE_NAME" nullable="false" />
            </basic>

			<basic name="submissionDate">
				<column name="SUBMISSION_DATE" nullable="false" />
			</basic>

			<basic name="submissionHeader">
				<column name="SUBMISSION_HEADER" nullable="true" />
			</basic>

			<basic name="inputData">
				<column name="INPUT_DATA" />
				<lob />
			</basic>

		</attributes>
	</entity>

	<entity class="com.travelex.tgbp.store.domain.Instruction"
		access="FIELD">
		<table name="INSTRUCTION" />
		<attributes>			

			<basic name="submissionId">
				<column name="SUB_ID" nullable="false" />
			</basic>

			<basic name="outputInstructionId">
				<column name="OUT_INS_ID" nullable="true" />
			</basic>

			<basic name="amount">
				<column name="AMOUNT" nullable="false" />
			</basic>

			<basic name="currency">
				<column name="CURRENCY" nullable="false" />
				<enumerated>STRING</enumerated>
			</basic>

			<basic name="valueDate">
				<column name="VALUE_DATE" nullable="false" />
			</basic>

			<basic name="paymentData">
				<column name="DATA" nullable="false" />
			</basic>

			<basic name="paymentGroupData">
				<column name="GROUP_DATA" nullable="false" />
			</basic>

		</attributes>
	</entity>

	<entity class="com.travelex.tgbp.store.domain.OutputSubmission"
		access="FIELD">
		<table name="OUTPUT_SUBMISSION" />
		<attributes>			

			<basic name="clearingMechanism">
				<column name="CLEARING_MECHANISM" nullable="false" />
				<enumerated>STRING</enumerated>
			</basic>
			
			<basic name="fileName">
                <column name="FILE_NAME" nullable="true" />
            </basic>

			<basic name="outputFile">
				<column name="OUTPUT_FILE" />
				<lob />
			</basic>

		</attributes>
	</entity>

	<entity class="com.travelex.tgbp.store.domain.OutputInstruction"
		access="FIELD">
		<table name="OUTPUT_INSTRUCTION" />
		<attributes>			

			<basic name="outputSubmissionId">
				<column name="OUT_SUB_ID" nullable="true" />
			</basic>

			<basic name="clearingMechanism">
				<column name="CLEARING_MECHANISM" nullable="false" />
				<enumerated>STRING</enumerated>
			</basic>

			<basic name="sourceIdentifier">
				<column name="SOURCE_IDEN" nullable="true" />
			</basic>

			<basic name="targetIdentifier">
				<column name="TARGET_IDEN" nullable="true" />
			</basic>

			<basic name="outputPaymentData">
				<column name="OUT_PAY_DATA" nullable="false" />
			</basic>

			<basic name="amount">
				<column name="AMOUNT" nullable="false" />
			</basic>

		</attributes>
	</entity>

	<entity class="com.travelex.tgbp.store.domain.rule.DynamicRule"
		access="FIELD">
		<table name="DYNAMIC_RULE" />
		<attributes>			

			<basic name="clearingMechanism">
				<column name="CLEARING_MECHANISM" nullable="false" />
			</basic>

			<basic name="ruleName">
				<column name="RULE_NAME" nullable="false" />
			</basic>

			<basic name="ruleText">
				<column name="RULE_TEXT" nullable="false" />
			</basic>

			<basic name="schema">
				<column name="SCHEMA_NAME" nullable="false" />
			</basic>

			<basic name="priority">
				<column name="PRIOIRTY" nullable="false" />
			</basic>
		</attributes>
	</entity>

	<entity
		class="com.travelex.tgbp.store.domain.routing.RoutingConfigOnValueDate"
		access="FIELD">
		<table name="ROUTING_CONFIG_ON_VALUE_DATE" />
		<attributes>			

			<basic name="currency">
				<column name="CURRENCY" nullable="false" />
				<enumerated>STRING</enumerated>
			</basic>

			<basic name="clearingMechanism">
				<column name="CLEARING_MECHANISM" nullable="false" />
				<enumerated>STRING</enumerated>
			</basic>

			<basic name="clearingPeriod">
				<column name="CLEARING_PERIOD" nullable="false" />
			</basic>

			<basic name="thresholdAmount">
				<column name="THRESHOLD_AMOUNT" nullable="false" />
			</basic>

			<basic name="charge">
				<column name="CHARGE" nullable="false" />
			</basic>
		</attributes>
	</entity>

	<entity
		class="com.travelex.tgbp.store.domain.output.OutputInstructionBatchingConfig"
		access="FIELD">
		<table name="OUTPUT_INS_BATCHING_CONFIG" />
		<attributes>
					
			<basic name="clearingMechanism">
				<column name="CLEARING_MECHANISM" nullable="false" />
				<enumerated>STRING</enumerated>
			</basic>

			<basic name="thresholdCount">
				<column name="THRESHOLD_COUNT" nullable="false" />
			</basic>

			<basic name="thresholdAmount">
				<column name="THRESHOLD_AMOUNT" nullable="false" />
			</basic>
		</attributes>
	</entity>

	<entity class="com.travelex.tgbp.store.domain.output.RemittanceAccountConfig"
		access="FIELD">
		<table name="REMITTANCE_ACCOUNT_CONFIG" />
		<attributes>			

			<basic name="clearingMechanism">
				<column name="CLEARING_MECHANISM" nullable="false" />
				<enumerated>STRING</enumerated>
			</basic>

			<basic name="bankId">
				<column name="BANK_ID" nullable="false" />
			</basic>

			<basic name="bankName">
				<column name="BANK_NAME" nullable="false" />
			</basic>

			<basic name="accountNumber">
				<column name="ACCOUNT_NUMBER" nullable="false" />
			</basic>

			<basic name="accountHolderName">
				<column name="ACCOUNT_HOLDER_NAME" nullable="false" />
			</basic>

			<basic name="accountHolderAddressLine1">
				<column name="ACCOUNT_HOLDER_ADDR_LINE1" nullable="false" />
			</basic>

			<basic name="accountHolderCity">
				<column name="ACCOUNT_HOLDER_CITY" nullable="false" />
			</basic>

			<basic name="accountHolderState">
				<column name="ACCOUNT_HOLDER_STATE" nullable="false" />
			</basic>

			<basic name="accountHolderZip">
				<column name="ACCOUNT_HOLDER_ZIP" nullable="false" />
			</basic>
		</attributes>
	</entity>

</entity-mappings>
