<composite xmlns="http://www.osoa.org/xmlns/sca/1.0" 
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:sca="http://www.osoa.org/xmlns/sca/1.0"
           xmlns:sca4j="urn:sca4j.org"
           name="PaymentGatewayIntegrationAssembly"
           targetNamespace="urn:composite:com.travelex.tgbp.integration"            
           autowire="false">

    <!-- Promoted services -->       
    <service name="schemaModelBuilder" promote="SchemaServices/schemaModelBuilder" />
    <service name="dynamicRuleSubmissionProcessor" promote="DynamicRules/dynamicRuleSubmissionProcessor" />
    <service name="inputSubmissionFtpListener" promote="InputSubmissionFtpListener/submissionFtpListener" />
    <service name="outputSchedulerService" promote="OutputScheduler/outputSchedulerService" />
    <service name="submissionQueryProcessor" promote="SubmissionQueryProcessor/SubmissionQueryProcessor" />
    <service name="outputConfigManagement" promote="OutputService/outputConfigManagement" />
    
    <property name="inputSubmissionBaseDir" />
    <property name="outputSubmissionBaseDir" />
    <property name="initialStartupDelayInSeconds" />
    <property name="instructionOutputDelayInSeconds" />
    <property name="fileOutputDelayInSeconds" />
	
	<component name="SchemaServices">
		<implementation.composite scdlResource="payment-gateway-schema-model.composite" />
	</component>
		
	<component name="DynamicRules" requires="sca:managedTransaction">
		<implementation.composite scdlResource="payment-gateway-dynamic-rules.composite" />
		<reference name="dataStore" target="DataStore" />
	</component>	
	
	<component name="EventNotifier">
		<implementation.composite scdlResource="payment-gateway-event-notifier.composite" />
	</component>		
		
	<component name="DataStore" requires="sca:managedTransaction">
    	<implementation.composite scdlResource="payment-gateway-store.composite" />
    </component>
    
    <component name="InputSubmissionFtpListener">
        <implementation.composite scdlResource="payment-gateway-submission-ftp.composite" />
        <reference name="submissionProcessor" target="SubmissionProcessor/submissionProcessor" />
        <property name="baseDir" source="$inputSubmissionBaseDir" />
    </component>
    
    <component name="SubmissionProcessor" requires="sca:managedTransaction">
        <implementation.composite scdlResource="payment-gateway-submission-processor.composite" />
        <reference name="submissionParser" target="SubmissionParser/submissionParser" />
        <reference name="dataStore" target="DataStore" />
        <reference name="eventNotifier" target="EventNotifier/eventNotifier" />        
    </component>

    <component name="SubmissionParser">
        <implementation.composite scdlResource="payment-gateway-submission-parser.composite" />
    </component>
    
    <component name="SubmissionQueryProcessor">
        <implementation.java class="com.travelex.tgbp.query.DefaultSubmissionQueryProcessor" />
        <reference name="dataStore" target="DataStore" />
    </component>
    
    <!-- Output components -->

    <component name="OutputScheduler">
        <implementation.composite scdlResource="payment-gateway-output-scheduler.composite" />
        <reference name="instructionOutputService" target="OutputService/instructionOutputService" />
        <reference name="fileOutputService" target="OutputService/fileOutputService" />
        <property name="initialStartupDelayInSeconds" source="$initialStartupDelayInSeconds" />
        <property name="instructionOutputDelayInSeconds" source="$instructionOutputDelayInSeconds" />
        <property name="fileOutputDelayInSeconds" source="$fileOutputDelayInSeconds" />
    </component>

    <component name="OutputService" requires="sca:managedTransaction">
        <implementation.composite scdlResource="payment-gateway-output-service.composite" />
        <reference name="dataStore" target="DataStore" />
        <reference name="eventNotifier" target="EventNotifier/eventNotifier" />
        <property name="outputBaseDir" source="$outputSubmissionBaseDir" />        
    </component>
    	
</composite>
